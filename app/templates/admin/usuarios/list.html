{% extends "admin/layout_admin.html" %}
{% block title %}Usuarios{% endblock %}
{% block header_title %}Gestión de Usuarios{% endblock %}

{% block content %}
<div class="section-header">
    <div><p style="color: var(--text-muted);">Control de acceso y personal</p></div>
    <a href="{{ url_for('admin.users_create') }}" class="btn-primary">
        <i class="bi bi-person-plus"></i> Nuevo Usuario
    </a>
</div>

<div class="table-container">
    <table class="modern-table">
        <thead>
            <tr>
                <th width="35%">Usuario / Personal</th> <th>Rol</th>
                <th>Contacto</th>
                <th>Fecha Registro</th>
                <th style="text-align: right;">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for u in users %}
            <tr>
                <td>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        {% if u.foto_path %}
                            <img src="{{ url_for('static', filename='uploads/usuarios/' + u.foto_path) }}"
                                 class="img-avatar-lg">
                        {% else %}
                            <div class="initials-avatar-lg" style="
                                background: {% if u.role == 'admin' %}var(--espresso){% else %}var(--pale-slate){% endif %};
                                color: {% if u.role == 'admin' %}var(--white){% else %}var(--text-main){% endif %};">
                                {{ u.nombre[0] }}
                            </div>
                        {% endif %}

                        <div>
                            <div style="font-weight: 700; font-size: 1.1rem; color: var(--text-main);">
                                {{ u.nombre }} {{ u.apellido_paterno }}
                            </div>
                            <div style="font-size: 0.9rem; color: var(--text-muted);">
                                {{ u.email }}
                            </div>
                        </div>
                    </div>
                </td>
                <td>
                    <span style="padding: 6px 12px; border-radius: 20px; font-weight: 600; font-size: 0.85rem;
                        {% if u.role == 'admin' %} background: var(--espresso-light); color: var(--espresso);
                        {% else %} background: #f3f4f6; color: var(--text-muted); {% endif %}">
                        {{ 'Administrador' if u.role == 'admin' else 'Colaborador' }}
                    </span>
                </td>
                <td>{{ u.telefono or '-' }}</td>
                <td>{{ u.created_at.strftime('%d/%m/%Y') }}</td>

                <td style="text-align: right;">
                    <a href="{{ url_for('admin.users_edit', user_id=u.id) }}" class="action-btn" title="Editar">
                        <i class="bi bi-pencil" style="font-size: 1.2rem;"></i>
                    </a>

                    {% if u.id != user.user_id %}
                    <form action="{{ url_for('admin.users_delete', user_id=u.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('¿Estás seguro de eliminar a este usuario? Esta acción borrará también sus datos personales.');">
                        <button type="submit" class="action-btn" style="color: #ef4444;" title="Eliminar">
                            <i class="bi bi-trash" style="font-size: 1.2rem;"></i>
                        </button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}