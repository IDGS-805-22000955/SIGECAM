{% extends "admin/layout_admin.html" %}
{% block title %}Editar Usuario{% endblock %}
{% block header_title %}Editar Perfil{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    
    {% if error %}
    <div style="background: #fee2e2; color: #b91c1c; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
        {{ error }}
    </div>
    {% endif %}

    <div class="section-card">
        <form method="POST" enctype="multipart/form-data">
            
            <div style="display: flex; gap: 2rem; align-items: center; margin-bottom: 2rem;">
                <div style="text-align: center;">
                    {% if edit_user.foto_path %}
                        <img id="preview-img" src="{{ url_for('static', filename='uploads/usuarios/' + edit_user.foto_path) }}" 
                             style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--espresso);">
                    {% else %}
                        <div id="preview-placeholder" style="width: 100px; height: 100px; background: var(--pale-slate); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: var(--grey-olive);">
                            {{ edit_user.nombre[0] }}
                        </div>
                        <img id="preview-img" src="" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--espresso); display: none;">
                    {% endif %}
                </div>
                <div style="flex: 1;">
                    <label class="form-label">Cambiar Foto</label>
                    <input type="file" name="foto" class="form-input" accept="image/*" onchange="previewImage(this)">
                </div>
            </div>

            <h4 style="color: var(--primary); border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; margin-bottom: 1.5rem;">
                Credenciales
            </h4>
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" name="email" class="form-input" value="{{ edit_user.email }}" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Rol</label>
                    <select name="role" class="form-input">
                        <option value="user" {% if edit_user.role == 'user' %}selected{% endif %}>Colaborador</option>
                        <option value="admin" {% if edit_user.role == 'admin' %}selected{% endif %}>Administrador</option>
                    </select>
                </div>
                <div class="form-group full-width">
                    <label class="form-label">Contraseña</label>
                    <input type="password" name="password" class="form-input" placeholder="Dejar en blanco para mantener la actual">
                </div>
            </div>

            <h4 style="color: var(--primary); border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; margin: 2rem 0 1.5rem 0;">
                Datos Personales
            </h4>
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">Nombre</label>
                    <input type="text" name="nombre" class="form-input" value="{{ edit_user.nombre }}" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Apellido Paterno</label>
                    <input type="text" name="apellido_paterno" class="form-input" value="{{ edit_user.apellido_paterno }}" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Apellido Materno</label>
                    <input type="text" name="apellido_materno" class="form-input" value="{{ edit_user.apellido_materno or '' }}">
                </div>
                <div class="form-group">
                    <label class="form-label">Teléfono</label>
                    <input type="text" name="telefono" class="form-input" value="{{ edit_user.telefono or '' }}">
                </div>
            </div>

            <h4 style="color: var(--primary); border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; margin: 2rem 0 1.5rem 0;">
                Dirección
            </h4>
            <div class="form-grid">
                <div class="form-group full-width">
                    <label class="form-label">Calle</label>
                    <input type="text" name="calle" class="form-input" value="{{ edit_user.calle or '' }}">
                </div>
                <div class="form-group">
                    <label class="form-label">Colonia</label>
                    <input type="text" name="colonia" class="form-input" value="{{ edit_user.colonia or '' }}">
                </div>
                <div class="form-group">
                    <label class="form-label">C.P.</label>
                    <input type="text" name="codigo_postal" class="form-input" value="{{ edit_user.codigo_postal or '' }}">
                </div>
            </div>

            <div class="form-actions">
                <a href="{{ url_for('admin.usuarios_list') }}" class="btn-secondary">Cancelar</a>
                <button type="submit" class="btn-primary">Guardar Cambios</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="{{ url_for('static', filename='scripts/admin_usuarios_edit.js') }}"></script>
{% endblock %}